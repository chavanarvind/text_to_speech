# === Step 6: Finalize Output (Concat + Priority + Merge with Keys) ===
finalize_output_step = PythonScriptStep(
    name="Step 6 - Finalize and Merge",
    script_name="step_6_finalize_output.py",
    source_directory="scripts",
    inputs=[final_output_to_adls, step1a_key_output_temp],
    arguments=[
        "--inference_output_dir", final_output_to_adls,
        "--key_output_dir", step1a_key_output_temp,
        "--final_merged_output_dir", final_merged_output
    ],
    outputs=[final_merged_output],
    runconfig=run_config,
    compute_target=compute_name,
    allow_reuse=False
)
