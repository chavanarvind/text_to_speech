def main(input_path, abbrev_map_path, output_path):
    global abbrev_map, abbrev_pattern

    # Load abbreviation map
    csv_files = glob.glob(os.path.join(abbrev_map_path, "*.csv"))
    if not csv_files:
        raise FileNotFoundError(f"No abbreviation CSV found in: {abbrev_map_path}")
    abbrev_df = pd.read_csv(csv_files[0])
    abbrev_map = {k.lower(): v for k, v in zip(abbrev_df['Abbreviation_list'], abbrev_df['Abbreviation_Expension'])}
    abbrev_pattern = re.compile(r'\b(' + '|'.join(re.escape(k) for k in abbrev_map.keys()) + r')\b', flags=re.IGNORECASE)

    # Process files
    os.makedirs(output_path, exist_ok=True)
    files = glob.glob(os.path.join(input_path, '*.parquet'))
    for file in files:
        try:
            df = pd.read_parquet(file)
            df['CMPNT_MATL_DESC'] = df['CMPNT_MATL_DESC'].str.replace(abbrev_pattern, replace_match, regex=True)

            output_file = os.path.join(output_path, os.path.basename(file))
            df.to_parquet(output_file, index=False)
            print(f"✅ Expanded abbreviations in: {output_file}")
        except Exception as e:
            print(f"❌ Failed: {file} -> {e}")
