Hereâ€™s where you need to check for the CHILD_NM:

Initial ingestion:

python
Copy
Edit
erp, tru, ... = ingest_data_and_prepare_examples(...)
ðŸ”¥ Add:

python
Copy
Edit
print("Step: After ingest_data_and_prepare_examples")
print(tru.query("CHILD_NM == 'PC-008694'"))
After preprocessing (raw material IDs):

python
Copy
Edit
erp, tru = format_raw_material_id(erp, tru)
ðŸ”¥ Add:

python
Copy
Edit
print("Step: After format_raw_material_id")
print(tru.query("CHILD_NM == 'PC-008694'"))
After text preprocessing:

python
Copy
Edit
erp, tru = preprocessed_text_description(erp, tru)
ðŸ”¥ Add:

python
Copy
Edit
print("Step: After preprocessed_text_description")
print(tru.query("CHILD_NM == 'PC-008694'"))
After features creation (called twice):

python
Copy
Edit
tru = create_features(tru, 'tru')
ðŸ”¥ Add after each call:

python
Copy
Edit
print("Step: After create_features (tru)")
print(tru.query("CHILD_NM == 'PC-008694'"))
After embeddings:

python
Copy
Edit
erp, tru = get_or_calculate_embeddings(...)
ðŸ”¥ Add:

python
Copy
Edit
print("Step: After get_or_calculate_embeddings")
print(tru.query("CHILD_NM == 'PC-008694'"))
After tru merge for expansion:

python
Copy
Edit
tru = tru.merge(unique_combinations, ...)
ðŸ”¥ Add:

python
Copy
Edit
print("Step: After tru.merge(unique_combinations)")
print(tru.query("CHILD_NM == 'PC-008694'"))
Before every call to match_by_reference_table:
Each call like:

python
Copy
Edit
matches_per_hfb, erp_to_match, tru_to_match, ... = match_by_reference_table(...)
ðŸ”¥ Add before call:

python
Copy
Edit
print("Step: Before match_by_reference_table")
print(tru_to_match.query("CHILD_NM == 'PC-008694'"))
Inside match_by_reference_table:
You already added debug prints, but you can also check:

python
Copy
Edit
print("\nDEBUG: TRU at entry of match_by_reference_table")
print(tru.query("CHILD_NM == 'PC-008694'"))
