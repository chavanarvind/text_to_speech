import os
import requests

# âœ… Your virtual env pyzbar folder
pyzbar_dir = r"C:\Users\AChava05\OneDrive - Kenvue\AChava05\video_analysis\qr_env\Lib\site-packages\pyzbar"
os.makedirs(pyzbar_dir, exist_ok=True)

# âœ… DLL file names and download URLs (64-bit verified)
dlls = {
    "libzbar-64.dll": "https://huggingface.co/datasets/arvindchavan-public/qr-dlls/resolve/main/libzbar-64.dll",
    "libiconv.dll": "https://huggingface.co/datasets/arvindchavan-public/qr-dlls/resolve/main/libiconv.dll"
}

# âœ… Step 1: Remove old DLLs
for dll_name in dlls:
    dll_path = os.path.join(pyzbar_dir, dll_name)
    if os.path.exists(dll_path):
        os.remove(dll_path)
        print(f"ğŸ—‘ï¸ Removed old {dll_name}")

# âœ… Step 2: Download new DLLs
for dll_name, url in dlls.items():
    print(f"â¬‡ï¸ Downloading {dll_name}...")
    try:
        r = requests.get(url)
        r.raise_for_status()
        with open(os.path.join(pyzbar_dir, dll_name), "wb") as f:
            f.write(r.content)
        print(f"âœ… Downloaded and saved: {dll_name}")
    except Exception as e:
        print(f"âŒ Failed to download {dll_name}: {e}")

print("\nğŸš€ Done. Restart your app and verify QR/barcode functionality.")
