# script_1_download_hbom_data.py
# --------------------------------
# Downloads the registered 'harmonized_bom_data_asset' dataset from Azure ML
# and saves it to the specified local or mounted output path.

import os
import argparse
from azureml.core import Run, Dataset

def main(output_path):
    # Get the current run context
    run = Run.get_context()
    ws = run.experiment.workspace

    # Fetch the dataset by registered name
    dataset = Dataset.get_by_name(ws, name='harmonized_bom_data_asset')

    # Create output directory if it doesn't exist
    os.makedirs(output_path, exist_ok=True)

    # Download dataset contents
    dataset.download(target_path=output_path, overwrite=True)

    print(f"âœ… Dataset downloaded to: {output_path}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--output_path", type=str, required=True, help="Output directory for downloaded dataset")
    args = parser.parse_args()

    main(args.output_path)
