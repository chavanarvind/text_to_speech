def expand_abbreviations(text, abbrev_map, pattern=None):
    def repl(m): return abbrev_map.get(m.group(0).lower(), m.group(0))
    if pattern is None:
        pattern = re.compile(r'\b(' + '|'.join(re.escape(k) for k in abbrev_map.keys()) + r')\b', flags=re.IGNORECASE)
    return pattern.sub(repl, text)
