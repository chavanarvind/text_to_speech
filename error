import glob
import os
import pandas as pd

# Setup
input_path = './data/target_map_cleaned_non_null_target'
all_files = glob.glob(os.path.join(input_path, '*.parquet'))

# Category column
target_col = 'Final Category'
category_counts = {}

# Read and count
for file in all_files:
    df = pd.read_parquet(file, columns=[target_col])
    df = df[df[target_col].notna()]
    df[target_col] = df[target_col].replace({'FNW or CHM': 'FNW_CHM'})
    
    counts = df[target_col].value_counts().to_dict()
    for cat, count in counts.items():
        category_counts[cat] = category_counts.get(cat, 0) + count

# Convert to DataFrame
dist_df = pd.DataFrame.from_dict(category_counts, orient='index', columns=['count'])
dist_df = dist_df.sort_values(by='count', ascending=False).reset_index()
dist_df.columns = ['category', 'count']

# Display
print("\nðŸ“Š Category Distribution:")
print(dist_df)
