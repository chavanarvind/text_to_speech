# üëá Add this after df_mapping = add_flags(df_mapping)
no_mapping = ~(
    df_mapping['Mapped_File_Category Filled'] |
    df_mapping['Mapped_File_Subcategory Filled']
)

no_description = (
    df_mapping['CMPNT_MATL_DESC'].isna() |
    df_mapping['CMPNT_MATL_DESC'].astype(str).str.strip().eq('')
)

# Find rows that have no mapping and no description
needs_reason_update = no_mapping & no_description

# ‚¨áÔ∏è Set reason and confidence accordingly
df_mapping.loc[needs_reason_update, 'AI_MATCHING_REASON_FINAL_CATEGORY'] = 'no component description'
df_mapping.loc[needs_reason_update, 'AI_MATCHING_REASON_FINAL_SUBCATEGORY'] = 'no component description'

df_mapping.loc[needs_reason_update, 'AI_FINAL_CATEGORY_CONFIDENCE'] = 0
df_mapping.loc[needs_reason_update, 'AI_FINAL_SUBCATEGORY_CONFIDENCE'] = 0
