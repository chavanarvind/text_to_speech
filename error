# Extract mapped rows
df_mapped = df_all[df_all.get('needs_model') == False].copy()

# ðŸš¨ Safety validation: Ensure all mapped rows have Final Category
missing_final_cat = df_mapped['Final Category'].isna() | df_mapped['Final Category'].astype(str).str.strip().eq("")
if missing_final_cat.any():
    raise ValueError(f"[ERROR] {missing_final_cat.sum()} rows are marked as needs_model=False but are missing Final Category.")
