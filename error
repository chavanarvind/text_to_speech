import os
import time
import polars as pl

def process_category_and_uom(file):
    try:
        print(f"🔄 Processing (category+uom): {os.path.basename(file)}")
        start = time.time()

        df = pl.read_parquet(file)

        # Clean CMPNT_CAT_CD_DESC and UOM Group
        df = df.with_columns([
            pl.col("CMPNT_CAT_CD_DESC").map_elements(
                lambda x: clean_text(x.lower()) if x else None,
                return_dtype=pl.Utf8
            ),
            pl.col("CMPNT_UOM_CD").map_elements(
                lambda x: get_unit_group(x),
                return_dtype=pl.Utf8
            ).alias("CMPNT_UOM_CD_GROUP")
        ])

        df.write_parquet(file)
        print(f"✅ Done (category+uom): {os.path.basename(file)} | ⏱️ {time.time() - start:.2f}s")

    except Exception as e:
        print(f"❌ Failed (category+uom): {os.path.basename(file)} -> {e}")
