merged_df.to_parquet(out_path, index=False)
    log(f"✅ Merged output saved: {out_path} (rows: {len(merged_df)})")
    log(f"💾 Memory usage after save: {psutil.virtual_memory().percent}%")

    except Exception as e:
        log(f"❌ Failed to process key file: {file}")
        log(f"   Reason: {str(e)}")

# 🔚 Cleanup after all key files
if os.path.exists(global_df_path):
    os.remove(global_df_path)
    log(f"🗑️ Deleted intermediate file: {global_df_path}")
