# Assign priority scores
final_df['priority'] = final_df['prediction_flag'].map({
    'Mapped_PreExtracted': 2,
    'Mapped': 2,
    'High Confidence': 1,
    'Low Confidence': 0
}).fillna(0)

# Sort to put mapped rows first
final_df = final_df.sort_values(by=['CMPNT_MATL_NUM', 'priority'], ascending=[True, False])

# Drop duplicates, keeping highest priority (mapped rows)
final_df = final_df.drop_duplicates(subset='CMPNT_MATL_NUM', keep='first')

# Optional: clean up
final_df.drop(columns='priority', inplace=True)
