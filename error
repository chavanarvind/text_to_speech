from azureml.core import Workspace, Datastore
import os

# === Azure ML Workspace Config ===
SUBSCRIPTION_ID = "a8d518a9-4587-4ba2-9a60-68b980c2f000"
RESOURCE_GROUP = "AZR-WDZ-DTO-AML-Development"
WORKSPACE_NAME = "AML-DTO-Marmot-dev"
DATASTORE_NAME = "xbomrefadlsg2"

# === Folder paths ===
local_folder = "./data/final_merged_predictions_updated"
blob_output_path = f"hbom_category_prediction/hbom_category_prediction_{datetime.today().strftime('%d%m%Y')}_updated/"

# === Connect to workspace and datastore ===
ws = Workspace(subscription_id=SUBSCRIPTION_ID,
               resource_group=RESOURCE_GROUP,
               workspace_name=WORKSPACE_NAME)

datastore = Datastore.get(ws, DATASTORE_NAME)

# === List files to upload ===
files_to_upload = [os.path.join(local_folder, f) for f in os.listdir(local_folder) if f.endswith(".parquet")]

# === Upload files ===
datastore.upload_files(
    files=files_to_upload,
    target_path=blob_output_path,
    overwrite=True,
    show_progress=True
)

print(f"âœ… Uploaded {len(files_to_upload)} files to: {blob_output_path}")
