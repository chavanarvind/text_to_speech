for idx, file_path in enumerate(parquet_files):
    print(f"\nüîÑ [Processing file]: {os.path.basename(file_path)}")
    try:
        df = pd.read_parquet(file_path)
        df = df[df['CMPNT_MATL_DESC'].notna()].drop_duplicates(subset=["CMPNT_MATL_NUM"])

        # Skip already seen components
        df = df[~df["CMPNT_MATL_NUM"].isin(seen_components)]
        if df.empty:
            print("[SKIPPED] All CMPNT_MATL_NUM already processed in previous files.")
            continue
        seen_components.update(df["CMPNT_MATL_NUM"].unique())

        df = ensure_ai_columns(df)
        df = apply_existing_ai_overrides(df)

        # Mapping logic...
        # ...

        if idx == 0:
            register_key_output(df, args.input_path, args.key_output, ws)

        output_file = os.path.join(args.final_output, f"mapped_{os.path.basename(file_path)}")
        finalize_output(df, output_file)

        # ‚úÖ Stop after one file if flag is set
        if process_only_one:
            break

    except Exception as e:
        print(f"[‚ùå ERROR] Failed to process {file_path}: {e}")
