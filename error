from multiprocessing import Pool, cpu_count
import glob
import os

input_path = './data/target_map_parquet_files'
files = glob.glob(os.path.join(input_path, '*.parquet'))

# Try using 80% of your cores
num_procs = max(1, int(cpu_count() * 0.8))

with Pool(processes=num_procs) as pool:
    pool.map(process_one_file, files)
