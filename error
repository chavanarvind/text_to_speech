import pandas as pd
from pathlib import Path

# Paths
temp_path = Path('./data/temp_grams')
output_path = Path('./data/gram_outputs/frequent_terms_by_category')
threshold = 20

# Load and aggregate unigram CSVs
all_uni = pd.concat([pd.read_csv(f) for f in temp_path.glob("unigrams_*.csv")], ignore_index=True)
final_uni = (
    all_uni.groupby(['category', 'word'])['count']
    .sum().reset_index()
    .query("count > @threshold")
)
final_uni.to_csv(output_path / "all_categories_unigrams.csv", index=False)

# Load and aggregate bigram CSVs
all_bi = pd.concat([pd.read_csv(f) for f in temp_path.glob("bigrams_*.csv")], ignore_index=True)
final_bi = (
    all_bi.groupby(['category', 'bigram'])['count']
    .sum().reset_index()
    .query("count > @threshold")
)
final_bi.to_csv(output_path / "all_categories_bigrams.csv", index=False)

print("âœ… Aggregation complete. Final CSVs saved.")
