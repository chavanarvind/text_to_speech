df_out.loc[df_out['prediction_flag'].str.contains("Mapped"), 'Final Subcategory'] = df_out['Final Subcategory']
df_out.loc[df_out['prediction_flag'].str.contains("Mapped"), 'Subcategory_Score'] = 1.0
df_out.loc[df_out['prediction_flag'].str.contains("Mapped"), 'Subcategory_Model'] = 'direct_mapping'
df_out.loc[df_out['prediction_flag'].str.contains("Mapped"), 'Predicted_Subcategory'] = df_out['Final Subcategory']

if not df_out.empty and 'prediction_flag' in df_out.columns:
    mask_mapped = df_out['prediction_flag'].astype(str).str.contains("Mapped", na=False)
    if mask_mapped.any():
        df_out.loc[mask_mapped, 'Final Subcategory'] = df_out.loc[mask_mapped, 'Final Subcategory']
        df_out.loc[mask_mapped, 'Subcategory_Score'] = 1.0
        df_out.loc[mask_mapped, 'Subcategory_Model'] = 'direct_mapping'
        df_out.loc[mask_mapped, 'Predicted_Subcategory'] = df_out.loc[mask_mapped, 'Final Subcategory']
