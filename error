def add_flags(df):
    # Sanitize mapped values: convert "nan", "NaN", "" to real NaN
    df['Mapped_File_Category'] = df['Mapped_File_Category'].replace(["nan", "NaN", ""], pd.NA)
    df['Mapped_File_Subcategory'] = df['Mapped_File_Subcategory'].replace(["nan", "NaN", ""], pd.NA)
    
    # Now flags will calculate correctly
    df['Mapped_File_Category Filled'] = df['Mapped_File_Category'].notna()
    df['Mapped_File_Subcategory Filled'] = df['Mapped_File_Subcategory'].notna()

    ...
