def insert_keys_batch(keys, lock):
    unique_keys = list(set(keys))
    values = [(k,) for k in unique_keys]
    with lock:
        conn = sqlite3.connect(SQLITE_DB_PATH)
        conn.execute("PRAGMA journal_mode=WAL;")
        conn.execute("PRAGMA synchronous=NORMAL;")
        cursor = conn.cursor()

        # âœ… Wrap inserts in a single transaction
        cursor.execute("BEGIN TRANSACTION;")
        cursor.executemany(f"INSERT OR IGNORE INTO {KEY_TABLE} (key) VALUES (?)", values)
        conn.commit()

        conn.close()
    return unique_keys
